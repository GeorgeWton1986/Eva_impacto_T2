---
title: "EVALUACIÓN DE IMPACTO - TALLER 2"
author: "VIÁFARA MORALES, JORGE ELIECER"
date: "2025-09-06"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

## Introduccion
En su artículo “Do Oil Windfalls Improve Living Standards? Evidence from Brazil” , Caselli y Michaels (2013) investigan el comportamiento de los gobiernos locales de Brasil cuando hay choques positivos de recursos. En particular, se preguntan si (1) choques positivos de petróleo resultan en un mayor gasto del gobierno y (2) si ese mayor gasto resulta en mejoras efectivas del bienestar de los lugares beneficiados del país. Para responder sus preguntas, los autores usan la metodología de Variables Instrumentales. En este taller, ustedes realizarán algunas de las estimaciones hechas por los autores e interpretarán los resultados. Para esto, ustedes deben usar una submuestra aleatoria de la base de datos oil_windfall.dta, la cual fue usada por los autores.  Así, justo después de abrir la base de datos – i.e., la base completa, deben eliminar aleatoriamente el 10% de las observaciones y usar la base restante.  La semilla que deben usar para que sus resultados sean replicables es su código de estudiante. 

Se recomienda tener respuestas tan breves como sea posible. Ciertas preguntas, sobre todo aquellas que preguntan por su opinión, pueden no tener una única respuesta correcta. Así, lo importante es que argumenten de manera coherente.  

## Primer Punto
Escriban la especificación principal de los autores (en niveles) y describan cada una de sus variables explicativas.

### Solución Primer Punto
De acuerdo con el enunciado la especificación principal del autor puede escribirse de la siguiente manera:

\begin{align}
W_{m} = \delta_1 &+ \theta_1 r_{m} + X'_{m}\rho_1+ u_{m1} \quad \nonumber \\
\end{align}

Nota: la nomenclatura utilizada en la ecución (1) sigue la convención de subíndices para indicar el nivel de agregación de las variables.

A continuaciòn, se definen los terminos de la ecuación (1):

-   **$W_{m}$:** Representa una variable de resultado de la $AMC_m$. Esto incluye una variedad de indicadores como el gasto reportado en diversas partidas del presupuesto municipal, la provisión real de bienes y servicios públicos, las transferencias sociales, el ingreso de los hogares y las tasas de pobreza, entre otros.

-  **$r_{m} (munbudgetrevenue2000predc)$:** Es una medida a nivel de la  $AMC_m$ de los ingresos municipales per cápita.

-  **$X'_{m}$:** Es un vector de controles geográficos a nivel de la $AMC_m$. Estos controles incluyen la latitud, la longitud, un indicador de si la AMC está en la costa, las distancias a las capitales federal y estatal, un dummy de capital estatal y efectos fijos de estado. La inclusión de estos controles geográficos es crucial porque las AMCs ricas en petróleo y las pobres en petróleo pueden diferir en características geográficas sistemáticas. El objetivo es asegurar que la abundancia de petróleo sea tan buena como asignada aleatoriamente, condicional a estas covariables geográficas.

  - **$latitude_{1998}$:** Coordenadas geográficas que ayudan a controlar por diferencias regionales.
  - **$longitude_{1998}$:** Coordenadas geográficas que ayudan a controlar por diferencias regionales.
  - **$distfederalcapital_{1998}$:** Distancia a la capital federal.
  - **$diststatecapital_{1998}$:** Distancia a la capital estatal.
  - **$statecapital$**: Un dummy que indica si la AMC es una capital estatal.

-  **$\delta_1, \theta_1, \rho_1$:** Son los coeficientes a estimar.

-  **$u_{m1}$** Es el término de error.

Manual avanzado de R markdown: https://rpubs.com/ricardo/14631 

## Segundo Punto

2.	¿Cuál es la intuición detrás de implementar Variables Instrumentales (VI) en vez de Mínimos Cuadrados Ordinarios (MCO)? En este escenario: Mencione al menos un sesgo del cual podríamos estar preocupados si interpretamos los efectos por MCO de manera causal. ¿Cuáles son los supuestos necesarios para que VI nos permita recuperar el efecto causal de interés? ¿Son creíbles los supuestos? Argumenten.

### Solución Segundo Punto

a) ¿Cuál es la intuición detrás de implementar Variables Instrumentales (VI) en vez de Mínimos Cuadrados Ordinarios (MCO)?

**Respuesta:**El método de la variable instrumental (VI) permite estimar el impacto de una variable o el efecto causal sobre el resultado estudiado. En aucencia de un experimiento aleatorio, se puede correr el riesgo de endogeneidad lo que causaria en los estimadores por MCO incosistencias y sesgos. En consecuencia, la implementacion del método de VI deberá encontrar una variables adicional (Instrumento) que logre explicar el resultado $W_{m}$ a través de la variable explicativa de interés que en este caso será $r_{m}$.

b)Mencione al menos un sesgo del cual podríamos estar preocupados si interpretamos los efectos por MCO de manera causal.

**Respuesta:**
Los ingresos municipales en general pueden tener diferentes fuentes de recursos, como por ejemplo, impuestos locales, servicios públicos, transferencias desde los gobiernos estatales y municipales, entre otros. Además, los ingresos podrán depender de diferentes caracteristicas locales, tales como, probreza monetaria o multidimencional, demografía, infraestructura, ect. Por lo tanto, es necesario estudiar las variables observadas que permitan establecer el efecto causal de $r_{m}$ sobre $W_{m}$. A continuacion, se explicará los diferentes tipos de sesgos en el contexto del problema, así,

 - **Sesgo por variable omitida**, dado que existen variables no observadas que influyen en los indicadores de $W_{m}$ que impiden estimar el efecto directo de $r_{m}$ sobre el resultado $W_{m}$.
 
 - **Sesgo por doble causalidad**, en este caso, los indicadores contenidos en la variables resultado $W_{m}$ pueden causar que los ingresos municipales $r_{m}$ cambien, dado que mejores o peores indicadores de resultados prioriza o no, el aumento de nuevos recursos municipales para las AMCs.
 
 - **Sesgo de selección**,las AMCs con mayores ingresos municipales $r_{m}$ a causa de la producción de petróleo onshore, difieren de aquellas AMCs que no cuentan con esta fuente de ingresos. Por lo tanto, se pueden presentar mejores indicadores de resultados $W_{m}$ mejores instalaciones eductivas, mejores servicios de salud, mayor industrialización, etc.

c) ¿Cuáles son los supuestos necesarios para que VI nos permita recuperar el efecto causal de interés? ¿Son creíbles los supuestos?

**Respuesta:** Los supuesto necesarios para que un Instrumento tenga valides son: Relevancia, Exclusión e Independicia. Para el articulo que estamos analizando, se plantea:

- El supuesto de **relevancia** desde el Instrumento $Q_{m}$, que esta en la capacidad de predecir $r_{m}$. Se expresa así: $E[Q_{m},r_{m}]\neq0$

- El supuesto de **exclusión** plantea que el instrumento $Q_{m}$ no debe tener un efecto directo sobre $W_{m}$, es decir, el instrumento solo afecta a la variable explicativa de interés $r_{m}$. Se expresa así: $E[Q_{m},W_{m}|r_{m},X'_{m}]=0$

- El supuesto de **independencia** describe que el instrumento $Q_{m}$ debe ser independiente del término de error en la ecuación estructural. Se expresa así: $E[Q_{m},u_{m}]=0$

Por lo tanto, se puede considerar que los supuestos planteados para el instrumento $Q_{m}$ tales como, la operación de petrobras, ubicación de la plataformas petroleras, entre otros son aleatorios. Además, la actividad petrolera en Brasil tiene poco efecto en las actividades no petroleras (Los efectos de derrame - Spillover) permiten establacer que los supuesto del instrumento son creíbles.

### Generalidades de R
```{r}
#Limpiar la consola
cat("\f")

#Limpiar el Global Environment
rm(list = ls())

#Incluir las librerias
if(!require(pacman)) install.packages("pacman") ; require(pacman)
p_load(haven,   #Leer archivos .dta
        dplyr,   #Manipular datos
        stargazer,  #Visualizar tablas de regresión
        fixest,  #Calcular los efectos fijos
        plm,  #Datos de panel
       knitr,   #Visualizar tablas adicionales
       ivreg  #Regresiones por variables instrumentales
      )
```

### Transformación de datos en R
```{r}
# Definir URL del repositorio
github_url <- "https://raw.githubusercontent.com/GeorgeWton1986/Eva_impacto_T2/main"
# Cargar datos
BD_0 <- read_dta(paste0(github_url, "/Data/oil_windfall_sin10perc.dta"))

# Ver estructura de los datos
glimpse(BD_0)
head(BD_0)

# Verificar los nombres de la columnas
colnames(BD_0)
```
### Filtrar datos offshore
```{r}

# Filtrar para municipios costeros sin petróleo onshore

#5. Para este taller, corran la regresión únicamente para municipios costeros (coastal = 1) y que reciben petróleo únicamente del mar (onshore = 0).

BD_filtrada <- BD_0 %>%
  filter(coastal == 1,
         onshore == 0)

print(paste("Observaciones después del filtro:", nrow(BD_filtrada)))
```

## Tercer Punto

En una tabla, presenten los resultados de estimar la primera etapa de la metodología de Variables Instrumentales. ¿Es el instrumento relevante y fuerte? Contesten esta pregunta usando los dos criterios recomendados en la clase magistral. 

### Especificación VI

**Respuesta:**
La ecuación de la primera etapa se expresa el término $r_{m}$ como funcion de $Q_{m}$ y $X'_{m}$, es decir:

\begin{equation}
r_{m,2000} = \delta_3 + η_3Q_{m,2000} + X´_m \rho_3 + w_{m3} \quad
\end{equation}


```{r}

#Regresion del modelo simple.

etapa_1 <- lm(mun_budget_revenue2000_pred_c ~ oilandgasvalue2000_cap + 
                latitude1998 + longitude1998 + dist_federal_capital1998 + 
                 dist_state_capital1998 + state_capital, 
               data = BD_filtrada)

# Resultados primera etapa
summary(etapa_1)

# Estadísticos de relevancia
coef_oil <- summary(etapa_1)$coefficients["oilandgasvalue2000_cap", ]
t_stat <- coef_oil["t value"]
f_stat <- summary(etapa_1)$fstatistic[1]

# Crear tabla para primera etapa
stargazer(etapa_1, type = "text", 
          title = "Primera Etapa: Ingresos Municipales",
          omit = c("latitude1998", "longitude1998", "dist_federal_capital1998", 
          "dist_state_capital1998", "state_capital", "Constant"),
          dep.var.labels = "Ingresos Municipales per cápita 2000")

print(paste("t-estadístico:", round(t_stat, 3)))
print(paste("F-estadístico:", round(f_stat, 3)))
print(paste("¿Instrumento relevante? (t > 1.96):", abs(t_stat) > 1.96))
print(paste("¿Instrumento fuerte? (F > 10):", f_stat > 10))
```

El instrumento es relevante dado que estadistico t es igual a 7.913, el cual es mayor a 1.96. De otro lado, el instrumento es fuerte con un estadistico F mayor a 10, en este caso es igual a 22.35.

## Cuarto Punto
4.	En una tabla, presenten e interpreten los resultados de estimar por VI el efecto de (mayores) ingresos públicos (producto del petróleo) sobre el gasto público reportado en el año 2000 en Educación y Cultura, Salud y Sanitización, Transporte y Transferencias Sociales. 

### Solución Cuarto Punto

```{r}

# Selección de variables.
gasto <- c("pmun_exp_funct_educ_cult2000c",
           "pmun_exp_funct_health_sanit2000c",
           "pmun_exp_funct_transport2000c",
           "pmun_exp_funct_welf2000c")

# Función para estimar VI
estimar_vi <- function(var_dep, BD_0) {
  formula_str <- paste(var_dep, "~ mun_budget_revenue2000_pred_c + latitude1998 + longitude1998 + 
                       dist_federal_capital1998 + dist_state_capital1998 + state_capital |
                       oilandgasvalue2000_cap + latitude1998 + longitude1998 + 
                       dist_federal_capital1998 + dist_state_capital1998 + state_capital")
  
  ivreg(as.formula(formula_str), data = BD_0) # Estimación por VI
}

# Estimaciones VI para gastos
vi_educacion <- estimar_vi("pmun_exp_funct_educ_cult2000c", BD_filtrada)
vi_salud <- estimar_vi("pmun_exp_funct_health_sanit2000c", BD_filtrada)
vi_transporte <- estimar_vi("pmun_exp_funct_transport2000c", BD_filtrada)
vi_transferencias <- estimar_vi("pmun_exp_funct_welf2000c", BD_filtrada)

# Tabla de resultados gastos
stargazer(vi_educacion, vi_salud, vi_transporte, vi_transferencias,
          type = "text",
          title = "Efectos VI en Gasto Público Reportado 2000",
          column.labels = c("Educación", "Salud", "Transporte", "Transferencias"),
          keep = "mun_budget_revenue2000_pred_c")

```

Nota: **oilandgasvalue2000_cap** corresponde a $Q_{m}$, producción petrolera per cápita en 2000. 

a)¿Cuál es el supuesto de identificación para que esta especificación les permita hacer interpretaciones causales?

**Respuesta:** Los resultados obtenidos sobre cada variable de gasto público mencionada para el año 2000. Se puede explicar de la siguiente manera: El gasto de educación aumenta en 11 centavos de real por cada real adicional que ingresa a la AMCs. El gasto en salud y transporte aunmentan 13 centavos por cada real adicional. El gasto en transferencias sociales aumenta en 6 centavos por cada real adicional. Por último, la significancia estadistica indique que los resultados son robustos para variable de gasto público analizada. 

El supuesto de identificación (Exclusión) presenta que la producción petrolera (instrumento) debe afectar el gasto público ÚNICAMENTE a través de los ingresos municipales, sin tener efectos directos sobre las decisiones de gasto. En otras palabras, el petróleo no puede influir directamente en cómo los gobiernos locales asignan sus recursos, solo indirectamente al proporcionarles más recursos disponibles.

## Quinto Punto
En una tabla, presenten e interpreten los resultados de estimar por VI el efecto de (mayores) ingresos públicos (producto del petróleo) sobre las variables efectivas de bienestar. En particular, sobre proporción de personas que no viven en favelas en 2000 y  el número de salones por millón de habitantes en el 2005. En texto describa los resultados para la primera variable

### Solución Quinto Punto

```{r}

# VI para variables de bienestar
vi_favelas <- estimar_vi("p_hhld_abovestrandard_ppl_2000", BD_filtrada)
vi_salones <- estimar_vi("clroomsMunicipal_pop2005", BD_filtrada)

# Tabla de resultados bienestar
stargazer(vi_favelas, vi_salones,
          type = "text", 
          title = "Efectos VI en Variables de Bienestar",
          column.labels = c("% No en Favelas 2000", "Salones por Millón 2005"),
          keep = "mun_budget_revenue2000_pred_c")

# Interpretación específica para favelas (primera variable)
coef_favelas <- coef(vi_favelas)["mun_budget_revenue2000_pred_c"]
se_favelas <- summary(vi_favelas)$coefficients["mun_budget_revenue2000_pred_c", "Std. Error"]

# cat("\nInterpretación para proporción que no vive en favelas:\n")
# cat(sprintf("Un millón de reales adicionales en ingresos municipales está asociado con un cambio de %.4f puntos porcentuales en la proporción de personas que no viven en condiciones por debajo del estándar.\n", 
#             coef_favelas * 1000000))
# cat(sprintf("Error estándar: %.4f\n", se_favelas * 1000000))
# cat(sprintf("¿Estadísticamente significativo? %s\n", 
#             ifelse(abs(coef_favelas/se_favelas) > 1.96, "Sí", "No")))

```

a) ¿Qué indican sus resultados?
**Respuesta:**Los resultados sugieren que un aumento en las ganancias de los municipios costeros por la explotación de petroleo costa afuera (offshore) tiene un efecto significativo sobre la personas que no viven en favelas. De manera cuantitativa, un aumento de cien mil de reales por cuenta de fuentes de ingresos petroleros disminuyen en 0.14 puntos porcentuales. Por otro lado, el efecto sobre los Salones por millón de estudiales es nulo. La intuición económica de esto fenomenos, puede estar determinada por el cambio en el nivel de vida una vez se desplazan para encontrar nuevas oportunidades laborales por la creacion de nuevos empleos en una economica que se dinamiza gracias a la actividad petrolera. Por el contrario, la infraestructura educativa representada en Salones, no esta priorizada por el gobierno local, porque puede considerar que este gasto no es apreciable para la población y por el contrario generaria una migración de familias hacia las AMCs petroleras. En conclusión, los resultados sobre el bienestar son mínimos.

b) ¿Mayores ingresos públicos resultan en niveles del bienestar medido a través de estas variables?
**Respuesta:** Los mayores ingresos públicos NO resultan en mejoras proporcionales del bienestar. Los resultados evidencian una desconexión preocupante: mientras el gasto público reportado aumenta sustancialmente (6-13 centavos por real adicional), las mejoras en bienestar efectivo son mínimas o inexistentes. Esto sugiere el fenómeno de 'dinero perdido' que documentan los autores, donde los recursos petroleros no se traducen en beneficios tangibles para la población, posiblemente debido a corrupción, patronazgo político o grave ineficiencia en la gestión pública municipal.